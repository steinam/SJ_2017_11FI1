
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="de">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Continuous Integration &#8212; Softwareentwicklung</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="index" title="Stichwortverzeichnis" href="genindex.html" />
    <link rel="search" title="Suche" href="search.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Stichwortverzeichnis"
             accesskey="I">Index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">SWE</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="continuous-integration">
<h1>Continuous Integration<a class="headerlink" href="#continuous-integration" title="Link zu dieser Überschrift">¶</a></h1>
<div class="section" id="einleitung">
<h2>Einleitung<a class="headerlink" href="#einleitung" title="Link zu dieser Überschrift">¶</a></h2>
<p>Dieses Tutorial soll einen Einstieg in die Aspekte</p>
<ul class="simple">
<li>Versionsverwaltung</li>
<li>Unit Testing</li>
<li>Metriken</li>
<li>Refactoring</li>
<li>Automatisierte Build</li>
<li>Continuous Integration</li>
</ul>
<p>bieten.</p>
<p>Es sind mittlerweile Grundelemente einer jeden (agilen) Softwareentwicklung und füllen den Begriff mit Inhalt.</p>
<ol class="arabic simple">
<li>Versionsverwaltung</li>
</ol>
<p>Nicht nur in Teams und verteilten Standorten ist eine Verwaltung des Quellcodes von außerordentlicher Bedeutung. Das Nachvollziehen von Änderungen, das eventuell notwendige Rückgängigmachen von Änderungen gehört heute zu jedem ordentlichen Programmierer dazu.
In unserem Beispiel werden wir mit Hilfe der zentralen Softwareverwaltung Subversion die grundlegenden Prinzipien kennenlernen. Dazu gehört z.B. auch</p>
<ul class="simple">
<li>die Absprache, an welchen Quellcode-Dateien ein Entwickler gerade arbeitet</li>
<li>das Vermeiden von Konflikten</li>
</ul>
<ol class="arabic simple">
<li>Unit Testing</li>
</ol>
<p>TDD (Test Driven Development) ist eine Vorgehensweise, die die Entwicklung des Programmcodes eng an das Testen des Quellcodes bindet. In einer extremen Sichtweise wird sogar der Test vor dem Schreiben des Quellcodes gelegt. Der Test definiert somit die Spezifikation des Pflichtenheftes.</p>
<p>Unit Testing hat zum Ziel, den Quellcode <strong>ständig, wiederholbar und automatisiert</strong> zu testen.
Jede Änderung im bestehenden Quellcode kann sofort durch einen Test validiert werden; der Entwickler enthält somit ein sofortiges Feedback über seine Änderungen.</p>
<p>Das Tutorial verwendet als Unit-Testing-Tool das Open-Source-Programm NUnit; die Vorgehensweise kann aber leicht an andere <em>Unit</em>-Testing-Frameworks angepasst werden.</p>
<ol class="arabic simple">
<li>Metriken</li>
</ol>
<p>Metriken messen bestimmte Eigenschaften von Quellcode, z.B. Lines of Code, Zyklomatische Komplexität, Vererbungstiefe, Kopplungsgrad von Objekten,…</p>
<p>Mit diesen Werten sind anschließend bestimmte Aussagen über die Qualität des Codes möglich. Schlechter Code kann anschließend refaktorisiert werden.</p>
<ol class="arabic simple">
<li>Refactoring</li>
</ol>
<p>Bestehender Quellcode ist häufig noch nicht „optimal“. Dies äußert sich z.B. in</p>
<ul class="simple">
<li>zu langen Methoden</li>
<li>Lagerung des Quellcodes am falschen Ort</li>
<li>Nicht-Beachten von allgemein anerkannten Programmierprinzipien</li>
<li>schlechten Metriken</li>
</ul>
<p>Refactoring beschreibt Vorgehensweisen, wie man solche „Probleme“ erkennt und behebt.
Weiterhin muss natürlich sichergestellt sein, dass nach einem Refactoring der Quellcode immer noch die gleichen Testergebnisse zurückliefert.</p>
<ol class="arabic simple">
<li>Automatische Builds</li>
</ol>
<p>Das Erstellen eines Programms bedeutet häufig mehr Arbeitsschritte als das reine Compilieren des Quellcodes. So müssen evtl.</p>
<ul class="simple">
<li>weitere Compiliervorgänge angestoßen werden</li>
<li>Tests aufgerufen weren</li>
<li>Datenbanken durch Skripte angepasst werden,</li>
<li>Ausgabeordner für das Compilat erstellt werden,</li>
<li>Setup-Programme aufgerufen werden</li>
<li>API-Dokumentationen aktualisiert werden.</li>
</ul>
<p>All diese Dinge könnten auch manuell angestoßen werden. Häufig werden aber diese Aufgaben nicht zeitnah ausgeführt oder vielleicht sogar vergessen.</p>
<p>Build-Tools können diese Aufgaben automatisieren, indem Sie einmal erstellt werden und dann lediglich aufgerufen werden. Sie dokumentieren damit gleichzeitig den firmeninternen Softwareentwicklungsprozess. In unserem Tutorial verwenden wir die Build-Tool MSBUILD und NAnt.</p>
<ol class="arabic simple">
<li>Continuous Integration (CI)</li>
</ol>
<p>CI führt die oben genannten Einzelschritte unter einer einheitlichen Oberfläche zusammen und bereitet die Ausgabe der entsprechenden Teilvorgänge in einer optisch ansprechenden Weise auf.</p>
<p>In unserem Tutorial verwenden wir den Open Source CI Server Jenkins;</p>
</div>
<div class="section" id="runde-1">
<h2>Runde 1<a class="headerlink" href="#runde-1" title="Link zu dieser Überschrift">¶</a></h2>
<div class="section" id="infrastruktur">
<h3>Infrastruktur<a class="headerlink" href="#infrastruktur" title="Link zu dieser Überschrift">¶</a></h3>
<p>Der Aufbau der verwendeten Software in unserem Tutorial ist wie folgt:</p>
<ul>
<li><p class="first">Visual Studio</p>
<p>Zur Arbeit mit dem Subversion-Server muss in VStudio ein SVN-Plugin (ANKH-SVN) installiert werden.
Sie finden das entsprechende Programm im Order CI auf dem tauschlaufwerk.</p>
</li>
<li><p class="first">Subversion-Server</p>
<p>Der entsprechende Quellcode ist pro Gruppe in einem SVN-Repository gespeichert.
Jede Gruppe hat ihr entsprechendes Login und hat RW-Zugriff auf das Repository.
Nachdem Sie das obige Plugin installiert haben, erstellen Sie in Visual Studio ein neues Projekt aus den Subversion-Server heraus und speichern es auf dem lokalen Rechner.</p>
<img alt="_images/VStudio_SVN_Projekt.jpg" src="_images/VStudio_SVN_Projekt.jpg" />
<img alt="_images/VStudio_SVN_Projekt_1.jpg" src="_images/VStudio_SVN_Projekt_1.jpg" />
<img alt="_images/VStudio_SVN_Projekt_2.jpg" src="_images/VStudio_SVN_Projekt_2.jpg" />
</li>
<li><p class="first">Weitere Tools werden zu gegebener Zeit in Visual Studio hinzugefügt.</p>
</li>
</ul>
</div>
<div class="section" id="das-programm">
<h3>Das Programm<a class="headerlink" href="#das-programm" title="Link zu dieser Überschrift">¶</a></h3>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Zu tun</p>
<p class="last">Hier das bestehende Program vorstellen.</p>
</div>
<p>Das Beispielprogramm ist sehr einfach gehalten. Das Programm berechnet die Kundengebühren eines fiktiven Kunden in einem Videoladen und druckt diese aus. Es erhält dafür die Filme, die ein Kunde ausgeliehen hat, sowie die Dauer der Ausleihe. Es berechnet dann die Gebühren und identifiziert die Art des Films (normal, Kinder, Neuheit). Zusätzlich berechnet das Programm „Rabattpunkte“, die davon abhängen, ob der Film eine Neuheit ist.</p>
<img alt="_images/prgramm_startingpoint.jpg" src="_images/prgramm_startingpoint.jpg" />
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="c1">//Movie.cs</span>

<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">namespace</span> <span class="nn">Before</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">enum</span> <span class="n">PriceCodes</span> <span class="p">{</span>
    <span class="n">Regular</span><span class="p">,</span> <span class="n">NewRelease</span><span class="p">,</span> <span class="n">Childrens</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">class</span> <span class="nc">Movie</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kt">string</span> <span class="n">m_Title</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">PriceCodes</span> <span class="n">m_PriceCode</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">Movie</span><span class="p">(</span><span class="kt">string</span> <span class="n">title</span><span class="p">,</span> <span class="n">PriceCodes</span> <span class="n">priceCode</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">m_Title</span> <span class="p">=</span> <span class="n">title</span><span class="p">;</span>
      <span class="n">m_PriceCode</span> <span class="p">=</span> <span class="n">priceCode</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">PriceCodes</span> <span class="n">PriceCode</span>  <span class="p">{</span>
      <span class="k">get</span> <span class="p">{</span><span class="k">return</span> <span class="n">m_PriceCode</span><span class="p">;}</span>
      <span class="k">set</span> <span class="p">{</span><span class="n">m_PriceCode</span> <span class="p">=</span> <span class="k">value</span><span class="p">;}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">string</span> <span class="n">Title</span>  <span class="p">{</span>
      <span class="k">get</span> <span class="p">{</span><span class="k">return</span> <span class="n">m_Title</span><span class="p">;}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="c1">//Rental.cs</span>

<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">namespace</span> <span class="nn">Fowler</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">class</span> <span class="nc">Rental</span>  <span class="p">{</span>
    <span class="k">private</span> <span class="n">Movie</span> <span class="n">m_Movie</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">m_DaysRented</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">Rental</span><span class="p">(</span><span class="n">Movie</span> <span class="n">movie</span><span class="p">,</span> <span class="kt">int</span> <span class="n">daysRented</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">m_Movie</span> <span class="p">=</span> <span class="n">movie</span><span class="p">;</span>
      <span class="n">m_DaysRented</span> <span class="p">=</span> <span class="n">daysRented</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">int</span> <span class="n">DaysRented</span> <span class="p">{</span>
      <span class="k">get</span> <span class="p">{</span><span class="k">return</span> <span class="n">m_DaysRented</span><span class="p">;}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">Movie</span> <span class="n">Movie</span> <span class="p">{</span>
      <span class="k">get</span> <span class="p">{</span><span class="k">return</span> <span class="n">m_Movie</span><span class="p">;}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="c1">//Customer.cs</span>

<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">namespace</span> <span class="nn">Fowler</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">class</span> <span class="nc">Customer</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kt">string</span> <span class="n">m_Name</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">ArrayList</span>  <span class="n">m_Rentals</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="p">();</span>

    <span class="k">public</span> <span class="nf">Customer</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">m_Name</span> <span class="p">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span>
      <span class="k">get</span> <span class="p">{</span><span class="k">return</span> <span class="n">m_Name</span><span class="p">;}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">AddRental</span><span class="p">(</span><span class="n">Rental</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">m_Rentals</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">arg</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">//public string Statement() { //See the next page }</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Die Statement-Methode in der Klasse Customer führt nun alle Berechnungen durch. Folgendes Sequenzdiagramm zeigt den prinzipiellen Ablauf:</p>
<img alt="_images/prgramm_startingpoint_seq.jpg" src="_images/prgramm_startingpoint_seq.jpg" />
<div class="highlight-csharp"><div class="highlight"><pre><span></span>    <span class="k">public</span> <span class="kt">string</span> <span class="nf">Statement</span><span class="p">()</span> <span class="p">{</span>
          <span class="kt">double</span> <span class="n">totalAmount</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
          <span class="kt">int</span> <span class="n">frequentRenterPoints</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
          <span class="n">IEnumerator</span> <span class="n">rentals</span> <span class="p">=</span> <span class="n">m_Rentals</span><span class="p">.</span><span class="n">GetEnumerator</span><span class="p">();</span>
          <span class="kt">string</span> <span class="n">result</span> <span class="p">=</span> <span class="s">&quot;Rental record for &quot;</span> <span class="p">+</span> <span class="n">m_Name</span> <span class="p">+</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
          <span class="k">while</span> <span class="p">(</span> <span class="n">rentals</span><span class="p">.</span><span class="n">MoveNext</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
            <span class="kt">double</span> <span class="n">thisAmount</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="n">Rental</span> <span class="n">each</span> <span class="p">=</span> <span class="p">(</span><span class="n">Rental</span><span class="p">)</span><span class="n">rentals</span><span class="p">.</span><span class="n">Current</span><span class="p">;</span>

            <span class="k">switch</span><span class="p">(</span><span class="n">each</span><span class="p">.</span><span class="n">Movie</span><span class="p">.</span><span class="n">PriceCode</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">case</span> <span class="n">PriceCodes</span><span class="p">.</span><span class="n">Regular</span><span class="p">:</span>
                <span class="n">thisAmount</span> <span class="p">+=</span> <span class="m">2</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">each</span><span class="p">.</span><span class="n">DaysRented</span> <span class="p">&gt;</span> <span class="m">2</span><span class="p">)</span> <span class="p">{</span>
                  <span class="n">thisAmount</span> <span class="p">+=</span> <span class="p">(</span><span class="n">each</span><span class="p">.</span><span class="n">DaysRented</span> <span class="p">-</span> <span class="m">2</span><span class="p">)</span> <span class="p">*</span> <span class="m">1.5</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">break</span><span class="p">;</span>

              <span class="k">case</span> <span class="n">PriceCodes</span><span class="p">.</span><span class="n">NewRelease</span><span class="p">:</span>
                <span class="n">thisAmount</span> <span class="p">+=</span> <span class="n">each</span><span class="p">.</span><span class="n">DaysRented</span> <span class="p">*</span><span class="m">3</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>

              <span class="k">case</span> <span class="n">PriceCodes</span><span class="p">.</span><span class="n">Childrens</span><span class="p">:</span>
                <span class="n">thisAmount</span> <span class="p">+=</span> <span class="m">1.5</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">each</span><span class="p">.</span><span class="n">DaysRented</span> <span class="p">&gt;</span> <span class="m">3</span><span class="p">)</span> <span class="p">{</span>
                  <span class="n">thisAmount</span> <span class="p">=</span> <span class="p">(</span><span class="n">each</span><span class="p">.</span><span class="n">DaysRented</span> <span class="p">-</span> <span class="m">3</span><span class="p">)</span> <span class="p">*</span> <span class="m">1.5</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">frequentRenterPoints</span><span class="p">++;</span>

            <span class="k">if</span> <span class="p">((</span><span class="n">each</span><span class="p">.</span><span class="n">Movie</span><span class="p">.</span><span class="n">PriceCode</span> <span class="p">==</span> <span class="n">PriceCodes</span><span class="p">.</span><span class="n">NewRelease</span><span class="p">)</span>
              <span class="p">&amp;&amp;</span> <span class="p">(</span><span class="n">each</span><span class="p">.</span><span class="n">DaysRented</span> <span class="p">&gt;</span> <span class="m">1</span><span class="p">))</span> <span class="p">{</span>
              <span class="n">frequentRenterPoints</span> <span class="p">++;</span>
            <span class="p">}</span>

            <span class="n">result</span> <span class="p">+=</span> <span class="s">&quot;\t&quot;</span> <span class="p">+</span> <span class="n">each</span><span class="p">.</span><span class="n">Movie</span><span class="p">.</span><span class="n">Title</span> <span class="p">+</span> <span class="s">&quot;\t&quot;</span>
              <span class="p">+</span> <span class="n">thisAmount</span><span class="p">.</span><span class="n">ToString</span><span class="p">()</span> <span class="p">+</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
            <span class="n">totalAmount</span> <span class="p">+=</span> <span class="n">thisAmount</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="n">result</span> <span class="p">+=</span> <span class="s">&quot;Amount owed is &quot;</span> <span class="p">+</span> <span class="n">totalAmount</span><span class="p">.</span><span class="n">ToString</span><span class="p">()</span> <span class="p">+</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
          <span class="n">result</span> <span class="p">+=</span> <span class="s">&quot;You earned &quot;</span> <span class="p">+</span> <span class="n">frequentRenterPoints</span><span class="p">.</span><span class="n">ToString</span><span class="p">()</span>
            <span class="p">+</span> <span class="s">&quot; frequent renter points.&quot;</span><span class="p">;</span>
          <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="entwickeln-unter-einer-versionsverwaltung">
<h3>Entwickeln unter einer Versionsverwaltung<a class="headerlink" href="#entwickeln-unter-einer-versionsverwaltung" title="Link zu dieser Überschrift">¶</a></h3>
<p>Die Entwicklung mit/ohne Versionsverwaltung unterscheidet sich zunächst nicht wesentlich. Es ist lediglich zu beachten, dass jegliche Änderungen zunächst nur an der lokalen Kopie ausgeührt werden. Ein Änderung im zentralen Versions-Repository muss durch den Entwickler mit Hilfe eines <strong>Commits</strong>
angestoßen werden.</p>
<p>Bei einer Arbeit im Team weiß der einzelne Entwickler nicht, welche teile des Quellcodes zur Zeit von seinen Kollegen bearbeitet wird. Um sein lokales Projekt auf dem aktuellen Stand zu halten, muss er deshalb selbts häüfig <strong>Updates</strong> aus dem zentralen Repository in seine lokale Kopie einspielen. Hat er in der Zwischenzeit gleiceh Quellode-Teile wie ein anderer Entwickler bearbeitet, führt dies automatisch zu Konflikten im Quellcode, die dann manuell gelößt werden müssen. Diese „Ärgernisse“ führen im Alltag aber eher dazu, dass sich Entwickler genau absprechen, wer welche Codeteile bearbeitet. Es ist damit eher von Vortiel als von Nachteil.</p>
<img alt="_images/svncycle.png" src="_images/svncycle.png" />
<p>In unserem Beispiel wollen wir in den bestehenden Code einige Unit-Tests einbauen.</p>
</div>
<div class="section" id="erstellen-von-unit-tests">
<h3>Erstellen von Unit-Tests<a class="headerlink" href="#erstellen-von-unit-tests" title="Link zu dieser Überschrift">¶</a></h3>
<div class="sidebar">
<p class="first sidebar-title">NuGet</p>
<p class="last">Informieren Sie sich über die NuGet-Pakteverwaltung von VisualStudio</p>
</div>
<p>Das Test-Framework NUnit kann auf verschiedene Weise installiert werden. Ein für das weitere Fortschreiten des  Projektes sinnvolles Vorgehen ist es, mit Hilfe des NuGet-Paketmanagers die notwendigen Dateien automatisch in das VStudio-Projekt zu integrieren.
Neben der Installation des NUnit-Frameworks muss dies als Verweis in die Solution mit eingebunden werden. Ein using-Statement erlaubt anschlie0end den Zugriff auf die Funktionalitäten des Test-Frameworks.</p>
<p>Für das Ausführen der Tests ist allerdings dennoch die manuelle Installation des Nunit-Frameworks notwendig.</p>
<div class="admonition note">
<p class="first admonition-title">Bemerkung</p>
<p>Beschreiben Sie die wesentliche Funktionsweise eines Unit-Test-Frameworks.</p>
<a class="last reference internal image-reference" href="_images/notiz.jpg"><img alt="_images/notiz.jpg" src="_images/notiz.jpg" style="width: 300px;" /></a>
</div>
<p>Zum Testen der korrekten Funktionalität sollen einige Demo-Objekte von Filmen, Kunden und Ausleihvorgängen erzeugt werden. Anschließend wird in einem ersten Test überprüft, ob die richtigen Daten zurückgeliefert werden.</p>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">NUnit.Framework</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">StartingPoint</span>
<span class="p">{</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// Unit tests for StartingPoint project.</span>
        <span class="c1">/// &lt;/summary&gt;</span>
<span class="na">        [TestFixture]</span>
        <span class="k">public</span> <span class="k">class</span> <span class="nc">UnitTests</span>
        <span class="p">{</span>
                <span class="cm">/* Fields */</span>

                <span class="c1">// Movies</span>
                <span class="n">Movie</span> <span class="n">m_Cinderella</span><span class="p">;</span>
                <span class="n">Movie</span> <span class="n">m_StarWars</span><span class="p">;</span>
                <span class="n">Movie</span> <span class="n">m_Gladiator</span><span class="p">;</span>

                <span class="c1">// Rentals</span>
                <span class="n">Rental</span> <span class="n">m_Rental1</span><span class="p">;</span>
                <span class="n">Rental</span> <span class="n">m_Rental2</span><span class="p">;</span>
                <span class="n">Rental</span> <span class="n">m_Rental3</span><span class="p">;</span>

                <span class="c1">// Customers</span>
                <span class="n">Customer</span> <span class="n">m_MickeyMouse</span><span class="p">;</span>
                <span class="n">Customer</span> <span class="n">m_DonaldDuck</span><span class="p">;</span>
                <span class="n">Customer</span> <span class="n">m_MinnieMouse</span><span class="p">;</span>

                <span class="cm">/* Methods */</span>

<span class="na">                [SetUp]</span>
                <span class="k">public</span> <span class="k">void</span> <span class="nf">Init</span><span class="p">()</span>
                <span class="p">{</span>
                        <span class="c1">// Create movies</span>
                        <span class="n">m_Cinderella</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;Cinderella&quot;</span><span class="p">,</span> <span class="n">PriceCodes</span><span class="p">.</span><span class="n">Childrens</span><span class="p">);</span>
                        <span class="n">m_StarWars</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;Star Wars&quot;</span><span class="p">,</span> <span class="n">PriceCodes</span><span class="p">.</span><span class="n">Regular</span><span class="p">);</span>
                        <span class="n">m_Gladiator</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;Gladiator&quot;</span><span class="p">,</span> <span class="n">PriceCodes</span><span class="p">.</span><span class="n">NewRelease</span><span class="p">);</span>

                        <span class="c1">// Create rentals</span>
                        <span class="n">m_Rental1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Rental</span><span class="p">(</span><span class="n">m_Cinderella</span><span class="p">,</span> <span class="m">5</span><span class="p">);</span>
                        <span class="n">m_Rental2</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Rental</span><span class="p">(</span><span class="n">m_StarWars</span><span class="p">,</span> <span class="m">5</span><span class="p">);</span>
                        <span class="n">m_Rental3</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Rental</span><span class="p">(</span><span class="n">m_Gladiator</span><span class="p">,</span> <span class="m">5</span><span class="p">);</span>

                        <span class="c1">// Create customers</span>
                        <span class="n">m_MickeyMouse</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Customer</span><span class="p">(</span><span class="s">&quot;Mickey Mouse&quot;</span><span class="p">);</span>
                        <span class="n">m_DonaldDuck</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Customer</span><span class="p">(</span><span class="s">&quot;Donald Duck&quot;</span><span class="p">);</span>
                        <span class="n">m_MinnieMouse</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Customer</span><span class="p">(</span><span class="s">&quot;Minnie Mouse&quot;</span><span class="p">);</span>
                <span class="p">}</span>

<span class="na">                [Test]</span>
                <span class="k">public</span> <span class="k">void</span> <span class="nf">TestMovie</span><span class="p">()</span>
                <span class="p">{</span>
                        <span class="c1">// Test title property</span>
                        <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="s">&quot;Cinderella&quot;</span><span class="p">,</span> <span class="n">m_Cinderella</span><span class="p">.</span><span class="n">Title</span><span class="p">);</span>
                        <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="s">&quot;Star Wars&quot;</span><span class="p">,</span> <span class="n">m_StarWars</span><span class="p">.</span><span class="n">Title</span><span class="p">);</span>
                        <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="s">&quot;Gladiator&quot;</span><span class="p">,</span> <span class="n">m_Gladiator</span><span class="p">.</span><span class="n">Title</span><span class="p">);</span>

                        <span class="c1">// Test price code</span>
                        <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n">PriceCodes</span><span class="p">.</span><span class="n">Childrens</span><span class="p">,</span> <span class="n">m_Cinderella</span><span class="p">.</span><span class="n">PriceCode</span><span class="p">);</span>
                        <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n">PriceCodes</span><span class="p">.</span><span class="n">Regular</span><span class="p">,</span> <span class="n">m_StarWars</span><span class="p">.</span><span class="n">PriceCode</span><span class="p">);</span>
                        <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n">PriceCodes</span><span class="p">.</span><span class="n">NewRelease</span><span class="p">,</span> <span class="n">m_Gladiator</span><span class="p">.</span><span class="n">PriceCode</span><span class="p">);</span>
                <span class="p">}</span>
</pre></div>
</div>
<p>Der entscheidende Test wird aber das Überprüfen der Statement()-Methode sein.</p>
<div class="admonition note">
<p class="first admonition-title">Bemerkung</p>
<p>Aufgabe</p>
<p class="last">Überlegen Sie, wie man die Statement-Methode testen könnte.</p>
</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="na">[Test]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">TestCustomer</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Test Name property</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="s">&quot;Mickey Mouse&quot;</span><span class="p">,</span> <span class="n">m_MickeyMouse</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="s">&quot;Donald Duck&quot;</span><span class="p">,</span> <span class="n">m_DonaldDuck</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="s">&quot;Minnie Mouse&quot;</span><span class="p">,</span> <span class="n">m_MinnieMouse</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>

    <span class="c1">// Test AddRental() method - set up for test</span>
    <span class="n">m_MickeyMouse</span><span class="p">.</span><span class="n">AddRental</span><span class="p">(</span><span class="n">m_Rental1</span><span class="p">);</span>
    <span class="n">m_MickeyMouse</span><span class="p">.</span><span class="n">AddRental</span><span class="p">(</span><span class="n">m_Rental2</span><span class="p">);</span>
    <span class="n">m_MickeyMouse</span><span class="p">.</span><span class="n">AddRental</span><span class="p">(</span><span class="n">m_Rental3</span><span class="p">);</span>

    <span class="cm">/* At this point, the structure of the program begins getting in the</span>
<span class="cm">    * way of testing. Rentals are imbedded in the Customer object, but</span>
<span class="cm">    * there is no property to access them. They can only be accessed</span>
<span class="cm">    * internally, by the Statement() method, which imbeds them in the</span>
<span class="cm">    * text string passed as it&#39;s return value. So, to get these amounts,</span>
<span class="cm">    * we will have to parse that value. */</span>

    <span class="c1">// Test the Statement() method</span>
    <span class="kt">string</span> <span class="n">theResult</span> <span class="p">=</span> <span class="n">m_MickeyMouse</span><span class="p">.</span><span class="n">Statement</span><span class="p">();</span>

    <span class="c1">// Parse the result</span>
    <span class="kt">char</span><span class="p">[]</span> <span class="n">delimiters</span> <span class="p">=</span> <span class="s">&quot;\n\t&quot;</span><span class="p">.</span><span class="n">ToCharArray</span><span class="p">();</span>
    <span class="kt">string</span><span class="p">[]</span> <span class="n">results</span> <span class="p">=</span> <span class="n">theResult</span><span class="p">.</span><span class="n">Split</span><span class="p">(</span><span class="n">delimiters</span><span class="p">);</span>

    <span class="cm">/* The results[] array will have the following elements:</span>
<span class="cm">    *           [0] = junk</span>
<span class="cm">    *           [1] = junk</span>
<span class="cm">    *           [2] = title #1</span>
<span class="cm">    *           [3] = price #1</span>
<span class="cm">    *           [4] = junk</span>
<span class="cm">    *           [5] = title #2</span>
<span class="cm">    *           [6] = price #2</span>
<span class="cm">    *           [7] = junk</span>
<span class="cm">    *           [8] = title #3</span>
<span class="cm">    *           [9] = price #3</span>
<span class="cm">    *           [10] = &quot;Amount owed is x&quot;</span>
<span class="cm">    *           [11] = &quot;You earned x frequent renter points.&quot;</span>
<span class="cm">    * We will test the title and price elements, and the total</span>
<span class="cm">    * and frequent renter points items. If these tests pass, then</span>
<span class="cm">    * we know that AddRentals() is adding rentals to a Customer</span>
<span class="cm">    * object properly, and that the Statement() method is</span>
<span class="cm">    * generating a statement in the expected format. */</span>

    <span class="c1">// Test the title and price items</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="s">&quot;Cinderella&quot;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="m">2</span><span class="p">]);</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="n">Convert</span><span class="p">.</span><span class="n">ToDouble</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="m">3</span><span class="p">]));</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="s">&quot;Star Wars&quot;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="m">5</span><span class="p">]);</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="m">6.5</span><span class="p">,</span> <span class="n">Convert</span><span class="p">.</span><span class="n">ToDouble</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="m">6</span><span class="p">]));</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="s">&quot;Gladiator&quot;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="m">8</span><span class="p">]);</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="m">15</span><span class="p">,</span> <span class="n">Convert</span><span class="p">.</span><span class="n">ToDouble</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="m">9</span><span class="p">]));</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="ausfuhren-der-tests">
<h3>Ausführen der Tests<a class="headerlink" href="#ausfuhren-der-tests" title="Link zu dieser Überschrift">¶</a></h3>
<p>In unserem Beispiel wurden die Tests innerhalb des Projektes definiert. In größeren Projekten würde ein eigenes Testprojekt definiert werden, welches das zu testende Projekt referenziert.
Mit der Installation des NUnit-Frameworks wird ein Testprogramm mitgeliefert; es befindet sich im bin-Verzeichnis. Nach dem erfolgreichen Compilieren des Quellcodes und dem Aufruf von nunit erscheint folgende grafische Oberfläche.</p>
<img alt="_images/NUnit_StartingPoint.jpg" src="_images/NUnit_StartingPoint.jpg" />
<p>Bei erfolgreichen Tests färbt sich der Balken grün.</p>
<img alt="_images/NUnit_StartingPoint_1.jpg" src="_images/NUnit_StartingPoint_1.jpg" />
</div>
<div class="section" id="commit-der-anderungen">
<h3>Commit der Änderungen<a class="headerlink" href="#commit-der-anderungen" title="Link zu dieser Überschrift">¶</a></h3>
<p>Fügen Sie die Änderungen des Quellcodes auch in das zentrale Repository hinzu, indem sie im Projektexplorer von VStudio CommitChanges anklicken.</p>
<img alt="_images/NUnit_StartingPoint_2.jpg" src="_images/NUnit_StartingPoint_2.jpg" />
<p>Der SVN-Client analysiert die Änderungen und trägt sie im zentralen Repository ein.</p>
</div>
</div>
<div class="section" id="runde-2">
<h2>Runde 2<a class="headerlink" href="#runde-2" title="Link zu dieser Überschrift">¶</a></h2>
<div class="section" id="automatische-builds">
<h3>Automatische Builds<a class="headerlink" href="#automatische-builds" title="Link zu dieser Überschrift">¶</a></h3>
<p>Bisher erfolgt ein neuer Build des Programms durch Drücken der Taste F5 innerhalb von VisualStudio auf dem Entwicklerrechner. Dies ist allerdings kein <strong>definiertes</strong> Vorgehen, da in Abhängigkeit von Betriebssystem, .NET-Plattform und Versionsständen von Fremd-Libraries unterschiedliche Rahmenbedingungen herrschen können.</p>
<p>Alle Aufgaben, die für einen erfolgreichen Buildvorgang vorzunehmen sind, sind am besten in Skripten zu zentralisieren. Für diese Aufgabe wurden bereits vor mehreren Jahrzehnten eigene Programme entwickelt. Wichtige Vertreter sind ANT, NANT, Maven, …. Microsoft verfügte lange Jahre über eine proprietäre Build-Engine, bis Sie sich vor vielen Jahen entschloss, mit Hilfe von MSBUILD einen von VisualStudio getrennten Build-Mechanismus zu entwickeln, der auch für Aufgaben außerhalb von VisualStudio verwendet werden kann.</p>
<p>In unserem Beispiel werden wir aufgrund vorhandener Kennnisstände das Tool NANT benutzen, auch wenn sich natürich für ein VisualStudio-Projekt msbuild besser eignen würde. Intern übergibt VisualStudio seine Build-Aufgaben an msbuild.</p>
</div>
<div class="section" id="nant">
<h3>NANT<a class="headerlink" href="#nant" title="Link zu dieser Überschrift">¶</a></h3>
<p>NANT ist ein OpenSource.Projekt und lehnt sich in seiner Arbeitsweise an das aus der Java-Welt bekannte ANT an.</p>
<p>Gesteuert wird NANT mit Hilfe eines Konfigurationsfiles <em>default.build</em>, in dem alle Aufgaben definiert werden, die NANT ausführen soll. Die Aufgaben (task) werden dabei mit Hilfe von targets organisiert.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">name=</span><span class="s">&quot;Startingpoint&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;build&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;exec</span> <span class="na">program=</span><span class="s">&quot;msbuild.exe&quot;</span>
      <span class="na">basedir=</span><span class="s">&quot;c:\Windows\Microsoft.NET\Framework64\v4.0.30319\&quot;</span>
      <span class="na">commandline=</span><span class="s">&quot;Pfad zur Solution\startingpoint.sln&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/target&gt;</span>


<span class="nt">&lt;/project&gt;</span>
</pre></div>
</div>
<p>Der Aufruf von <strong>nant build</strong> führt dann zum Ausführen des Buildvorganges.</p>
<img alt="_images/nant_1.jpg" src="_images/nant_1.jpg" />
</div>
<div class="section" id="msbuild">
<h3>MSBUILD<a class="headerlink" href="#msbuild" title="Link zu dieser Überschrift">¶</a></h3>
<p>Die Arbeit mit msbuild gestaltet sich noch einfacher. Der Buildprozess kann dadurch gestartet werden, dass man dem Konsolenprogramm msbuild.exe den Pfad zur Solution übergibt.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>c:<span class="se">\W</span>indows<span class="se">\M</span>icrosoft.NET<span class="se">\F</span>ramework64<span class="se">\v</span><span class="m">4</span>.0.30319<span class="se">\m</span>sbuild.exe Pfad_zur_Solution.sln
</pre></div>
</div>
</div>
<div class="section" id="nunit-integration">
<h3>NUnit-Integration<a class="headerlink" href="#nunit-integration" title="Link zu dieser Überschrift">¶</a></h3>
<p>Grundsätzlich kann NUnit sowohl in NANT als auch in MSBUILD integriert werden. In unserem Beispiel werden wir die Integration mit Hilfe des NANT-Tools zeigen.</p>
<p>Eine Konfigurationsdatei von NANT kann verschiedene Tasks besitzen, die auch selbständig voneinander ausgerufen werden können.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">name=</span><span class="s">&quot;Startingpoint&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;build&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;exec</span> <span class="na">program=</span><span class="s">&quot;msbuild.exe&quot;</span>
              <span class="na">basedir=</span><span class="s">&quot;c:\Windows\Microsoft.NET\Framework64\v4.0.30319\&quot;</span>
              <span class="na">commandline=</span><span class="s">&quot;C:\temp\fowler\startpoint\startingpoint.sln&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/target&gt;</span>
        <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;test&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;exec</span> <span class="na">program=</span><span class="s">&quot;c:\Program Files (x86)\NUnit 2.6.3\bin\nunit-console.exe&quot;</span>
              <span class="na">commandline=</span><span class="s">&quot;C:\temp\fowler\startpoint\bin\Debug\StartingPoint.exe /xml=C:\temp\fowler\startpoint\bin\Debug\result_test.xml&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/target&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre></div>
</div>
<p>Der Parameter /xml gibt den Dateinamen an, in der NUnit seine Ausgaben schreiben soll. Diese Datei wird von uns später noch ausgewertet werden.
Der Aufruf des Test-Targets erfolgt dann wie folgt.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>Microsoft Windows <span class="o">[</span>Version <span class="m">6</span>.3.9600<span class="o">]</span>
<span class="o">(</span>c<span class="o">)</span> <span class="m">2013</span> Microsoft Corporation. Alle Rechte vorbehalten.

C:<span class="se">\t</span>emp<span class="se">\f</span>owler<span class="se">\S</span>tartPoint&gt;c:<span class="se">\t</span>emp<span class="se">\n</span>ant<span class="se">\b</span>in<span class="se">\N</span>Ant.exe <span class="nb">test</span>
NAnt <span class="m">0</span>.92 <span class="o">(</span>Build <span class="m">0</span>.92.4543.0<span class="p">;</span> release<span class="p">;</span> <span class="m">09</span>.06.2012<span class="o">)</span>
Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2001</span>-2012 Gerry Shaw
http://nant.sourceforge.net

Buildfile: file:///C:/temp/fowler/StartPoint/default.build
Target framework: Microsoft .NET Framework <span class="m">4</span>.0
Target<span class="o">(</span>s<span class="o">)</span> specified: <span class="nb">test</span>


test:

     <span class="o">[</span>exec<span class="o">]</span> NUnit-Console version <span class="m">2</span>.6.3.13283
     <span class="o">[</span>exec<span class="o">]</span> Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2002</span>-2012 Charlie Poole.
     <span class="o">[</span>exec<span class="o">]</span> Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2002</span>-2004 James W. Newkirk, Michael C. Two, Alexei A. Vorontsov.
     <span class="o">[</span>exec<span class="o">]</span> Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2000</span>-2002 Philip Craig.
     <span class="o">[</span>exec<span class="o">]</span> All Rights Reserved.
     <span class="o">[</span>exec<span class="o">]</span>
     <span class="o">[</span>exec<span class="o">]</span> Runtime Environment -
     <span class="o">[</span>exec<span class="o">]</span>    OS Version: Microsoft Windows NT <span class="m">6</span>.2.9200.0
     <span class="o">[</span>exec<span class="o">]</span>   CLR Version: <span class="m">2</span>.0.50727.8000 <span class="o">(</span> Net <span class="m">3</span>.5 <span class="o">)</span>
     <span class="o">[</span>exec<span class="o">]</span>
     <span class="o">[</span>exec<span class="o">]</span> ProcessModel: Default    DomainUsage: Single
     <span class="o">[</span>exec<span class="o">]</span> Execution Runtime: net-3.5
     <span class="o">[</span>exec<span class="o">]</span> ...
     <span class="o">[</span>exec<span class="o">]</span> Tests run: <span class="m">3</span>, Errors: <span class="m">0</span>, Failures: <span class="m">0</span>, Inconclusive: <span class="m">0</span>, Time: <span class="m">0</span>,21134 <span class="m">9783145239</span> seconds
     <span class="o">[</span>exec<span class="o">]</span>   Not run: <span class="m">0</span>, Invalid: <span class="m">0</span>, Ignored: <span class="m">0</span>, Skipped: <span class="m">0</span>
     <span class="o">[</span>exec<span class="o">]</span>

BUILD SUCCEEDED

Total time: <span class="m">3</span>.2 seconds.
</pre></div>
</div>
</div>
<div class="section" id="metrics-integration">
<h3>Metrics-Integration<a class="headerlink" href="#metrics-integration" title="Link zu dieser Überschrift">¶</a></h3>
<div class="sidebar">
<p class="first sidebar-title">Installation</p>
<p>In VStudio 2012 fehlte das Konsolenprogramm metrics.exe. Es muss in das Verzeichnis c:Program Files (x86)Microsoft Visual Studio 11.0Team ToolsStatic Analysis ToolsFxCop kopiert werden</p>
<p>Der Aufruf erfolgt mit</p>
<p class="last">metrics /f:metrics.exe /o:C:tempMetricsresult.xml</p>
</div>
</div>
<div class="section" id="was-soll-das">
<h3>Was soll das ?<a class="headerlink" href="#was-soll-das" title="Link zu dieser Überschrift">¶</a></h3>
<p>Berechtigterweise muss man sich fragen, warum man all diesen Aufwand treibt, wenn man doch all diese Dinge auch über VisualStudio hätte erreichen können. Die Antwort liegt in Tatsache, dass man heutzutage als Entwickler kein Einzelkämpfer ist. Der Build und die darum liegenden Tätigkeiten müssen zentralisiert und automatisiert werden. Es ist Zeit für den CI Server.</p>
</div>
</div>
<div class="section" id="runde-3">
<h2>Runde 3<a class="headerlink" href="#runde-3" title="Link zu dieser Überschrift">¶</a></h2>
<div class="section" id="ci-server-jenkins">
<h3>CI Server Jenkins<a class="headerlink" href="#ci-server-jenkins" title="Link zu dieser Überschrift">¶</a></h3>
<p>Jenkins (<a class="reference external" href="http://jenkins-ci.org">http://jenkins-ci.org</a>) ist ein Fork des CI-Servers Hudson. Es gibt ihn für verschiedene Betriebssysteme, darunter auch Windows. Das msi-Paket sollte man als Administrator installieren; ein Installationspfad außerhalb von Program Files hat sich zumindest auf meinem Windows 8 - System als nützlich erwiesen.</p>
<img alt="_images/jenkins_ci.jpg" src="_images/jenkins_ci.jpg" />
<p>Jenkins ist über Plugins flexibel konfigurierbar; in unserem Falle werden wir folgende Plugins installieren:</p>
<img alt="_images/jenkins_plugins.jpg" src="_images/jenkins_plugins.jpg" />
<ul class="simple">
<li>NUnit: Zum Rendern der NUnit-Ausgabe</li>
<li>MSBUILD: Zum Builden von Solution-Files</li>
<li>NANT: Zum Anstoßen weiterer Funktionalitäten</li>
<li>VStudio Code Metrics: Zum Erzeugen einfacher Metriken per metrics.exe</li>
</ul>
<p>Diese Plugins müssen global installiert und konfiguriert werden.</p>
<img alt="_images/jenkins_msbuild.jpg" src="_images/jenkins_msbuild.jpg" />
<img alt="_images/jenkins_nant.jpg" src="_images/jenkins_nant.jpg" />
<img alt="_images/jenkins_projekt_svn.jpg" src="_images/jenkins_projekt_svn.jpg" />
<p>Weitere Konfigurationen werden dann innerhalb eines Projekte vorgenommen.</p>
<p>Weiterhin müssen noch Benutzer mit entsprechenden Zugriffsberechtigungen auf jeweilige Projekte angelegt werden.</p>
</div>
<div class="section" id="jobs-anlegen">
<h3>Jobs anlegen<a class="headerlink" href="#jobs-anlegen" title="Link zu dieser Überschrift">¶</a></h3>
<p>Das Anlegen eines Projektes erfolgt in Jenkins unter <strong>Neues Item anlegen</strong></p>
<img alt="_images/jenkins_freestyle.jpg" src="_images/jenkins_freestyle.jpg" />
<img alt="_images/jenkins_projekt_einstellung.jpg" src="_images/jenkins_projekt_einstellung.jpg" />
</div>
<div class="section" id="jobs-konfigurieren">
<h3>Jobs Konfigurieren<a class="headerlink" href="#jobs-konfigurieren" title="Link zu dieser Überschrift">¶</a></h3>
<p>In unserem beispiel sollen die bisher lokal ausgeführten Bild-Schritte nun durch Jenkins realisiert werden. Dazu sind die Schritte <strong>Buildverfahren</strong> sowie <strong>Post-Build-Aktion</strong> zu konfigurieren.</p>
<img alt="_images/build_aktion.jpg" src="_images/build_aktion.jpg" />
<p>Buildverfahren definieren dabei die Aktionen, die ausgeführt werden müssen. Post-Build-Aktionen definieren dabei, was mit den Ergebnissen der Build-Verfahren geschehen soll. In unserem Beispiel werden die Ergebnisse der NANT und Metrics-Ausgaben (XMl-Dateien) über einen „Publisher“ grafisch aufbereitet und in die Übersichtsseite des jeweiligen Buildvorgangs dann integriert.
Voraussetzung dafür war natürlich das Installieren der jeweiligen Publisher-Plugins in Jenkins zuvor.</p>
<img alt="_images/build_publish.jpg" src="_images/build_publish.jpg" />
<p>Falls alles klappt, sieht anschließend die Startseite eines Projektes wie folgt aus.</p>
<img alt="_images/project_dashboard.jpg" src="_images/project_dashboard.jpg" />
<p>Nach dem Klicken auf einen jeweiligen Buildvorgang werden Details dargestellt.</p>
<img alt="_images/project_metrics.jpg" src="_images/project_metrics.jpg" />
<img alt="_images/project_nunit.jpg" src="_images/project_nunit.jpg" />
</div>
<div class="section" id="aufgaben">
<h3>Aufgaben:<a class="headerlink" href="#aufgaben" title="Link zu dieser Überschrift">¶</a></h3>
<ul>
<li><p class="first">Erstellen API-Dokumentation</p>
<p>Das Programm doxygen (<a class="reference external" href="http://www.doxygen.org">http://www.doxygen.org</a>) erstellt aus dem Quellcode eines Programms eine API-Dokumentation. Der Ablauf der lokalen Erstellung ist wie folgt:</p>
<ul>
<li><p class="first">Definieren eines Konfigurationsfiles mit Hilfe eines GUI-Tools (doxywizard)</p>
<img alt="_images/doxygen_wizard.jpg" src="_images/doxygen_wizard.jpg" />
</li>
<li><p class="first">Erstellen eines API-Dokumentation durch Aufruf von</p>
<img alt="_images/doxygen_aufruf.jpg" src="_images/doxygen_aufruf.jpg" />
</li>
</ul>
</li>
</ul>
<div class="sidebar">
<p class="first sidebar-title">Beachte</p>
<blockquote>
<div>In Jenkins muss zur Ausgabe der HTML-Publisher-Plugin instaliert werden</div></blockquote>
<div class="admonition-aufgabe last admonition">
<p class="first admonition-title">Aufgabe</p>
<p>Erstellen sie eine lokal ablauffähige Lösung.</p>
<p>Passen Sie dann die entsprechende Konfiguration an und implementieren Sie diese auf dem CI Server Jenkins. Doxygen ist auf dem CI Server installiert.</p>
<p class="last">Zum Ablauf der Erstellung muss natürlich ein neues Target innerhalb des NANT-Buildfiles erstellt werden.</p>
</div>
</div>
<ul>
<li><p class="first">Erstellen Installer Innosetup</p>
<p>Ähnlich wie bei Doxygen kann man mit Hilfe des Programms Innnosetup einen Installer erstellen lassen. Der Ablauf ist prinzipiell der gleich wie bei doxygen.</p>
<p>Mit Hilfe eines Wizards wird ein Konfigurationsfile erstellt, welches dann über ein Konsolenprogramm aufgerufen wird. Dieser Aufruf muss dann in gleicher Weise auf dem CI Server abgebildet werden.</p>
<p>Das Konsolenprogramm für den Aufruf des installers heißt iscc.exe. Dies erwartet als Kommandozeilenparameter die Übergabe eines Konfigurationsfiles.</p>
<p>Die Vorgehensweise auf der CI-Server-Seite ist die gleiche wie beim Erstellen der Doku.</p>
<img alt="_images/innosetup_1.jpg" src="_images/innosetup_1.jpg" />
<img alt="_images/innosetup_2.jpg" src="_images/innosetup_2.jpg" />
<img alt="_images/innosetup_3.jpg" src="_images/innosetup_3.jpg" />
<div class="admonition-aufgabe admonition">
<p class="first admonition-title">Aufgabe</p>
<p>Erstellen sie eine lokal ablauffähige Lösung.</p>
<p>Passen Sie dann die entsprechende Konfiguration an und implementieren Sie diese auf dem CI Server Jenkins. Innosetup (iscc.exe)  ist auf dem CI Server installiert.</p>
<p class="last">Zum Ablauf der Erstellung muss natürlich ein neues Target innerhalb des NANT-Buildfiles erstellt werden.</p>
</div>
</li>
<li><p class="first">Darstellen von Artefakten</p>
<p>Häufig haben Build-Prozesse auch Ergebnisse in Dateiform. Bei einem Installer wird z.B. am Ende eine Datei setup.exe erzeugt, die man gerne innerhalb des Ci-Servers dann anzeigen würde.</p>
<p>Jenkis kennt für diese Aufgabe die sog. Artefact-Plugins, die solche Dateien dann in der Projektoberfläche anklickbar machen. In unserem Falle wurde das <strong>Artifact Deployer Plugin</strong> verwendet, um die Datei setup.exe zu verlinken.</p>
<img alt="_images/artifact_1.jpg" src="_images/artifact_1.jpg" />
<div class="admonition-aufgabe admonition">
<p class="first admonition-title">Aufgabe</p>
<p class="last">Bilden sie die Ausgabe der Datei setup.exe mit Hilfe des Plugins ab.</p>
</div>
<img alt="_images/artifact_2.jpg" src="_images/artifact_2.jpg" />
</li>
</ul>
</div>
</div>
<div class="section" id="runde-4">
<h2>Runde 4<a class="headerlink" href="#runde-4" title="Link zu dieser Überschrift">¶</a></h2>
<div class="section" id="refactoring">
<h3>Refactoring<a class="headerlink" href="#refactoring" title="Link zu dieser Überschrift">¶</a></h3>
<div class="admonition-zitat admonition">
<p class="first admonition-title">Zitat</p>
<p>Refactoring (auch Refaktorierung oder Restrukturierung) bezeichnet in der Software-Entwicklung die manuelle oder automatisierte Strukturverbesserung von Quelltexten unter Beibehaltung des beobachtbaren Programmverhaltens. Dabei sollen die Lesbarkeit, Verständlichkeit, Wartbarkeit und Erweiterbarkeit verbessert werden, mit dem Ziel, den jeweiligen Aufwand für Fehleranalyse und funktionale Erweiterungen deutlich zu senken.</p>
<p>Refactoring ist ein zentraler Bestandteil der Agilen Softwareentwicklung. Dort wird meist von „kontinuierlichem“ Refactoring [1] oder „kompromisslosem“ Refactoring [2] gesprochen. Refactoring ist in der agilen Softwareentwicklung wie Kodieren oder Modultesten ein integraler Bestandteil des Softwareentwicklungsprozesses und nicht auf bestimmte Zeiten bzw. Phasen beschränkt.</p>
<p class="last">Quelle: <a class="reference external" href="http://de.wikipedia.org/wiki/Refactoring">http://de.wikipedia.org/wiki/Refactoring</a></p>
</div>
<p>Refactoring wird hauptsächlich auf unschöne Stellen im Code (siehe Code-Smell) angewandt. Diese sind z.B. mit Hilfe von schlechten Metrikwerten als solche zu erkennen. Dabei wird der Quelltext eines Computerprogramms umgestaltet, wobei die tatsächliche Programmfunktion unverändert bleiben soll. Die Umgestaltung des Quelltextes erfolgt meist nach folgenden Gesichtspunkten:</p>
<ul class="simple">
<li>Lesbarkeit</li>
<li>Übersichtlichkeit</li>
<li>Verständlichkeit</li>
<li>Erweiterbarkeit</li>
<li>Vermeidung von Redundanz</li>
<li>Testbarkeit</li>
</ul>
<p>Folgendes sind besonders häufig eingesetzte Refactorings:</p>
<ul class="simple">
<li>Änderung eines Symbolnamens.</li>
<li>Verschieben eines Symbols in ein anderes Modul, z. B. eine Methode in eine andere Klasse.</li>
<li>Aufteilung eines Moduls (z. B. Paket, Klasse, Methode) in mehrere kleinere Module oder Zusammenlegung kleinerer Module zu einem größeren.</li>
<li>Im weitesten Sinne auch die Umformatierung eines Quelltextes, z. B. mit einem Beautifier.</li>
<li>Bei geänderten Geschäftsprozessen bei Darstellung mittels der Unified Modeling Language UML kann mittels „Refactoring“ der Programmcode geändert werden. Dadurch wird eine robuste und stabile Systemarchitektur geschaffen, da unübersichtliche Änderungen nicht im Code initiiert werden müssen.</li>
</ul>
<p>Im weiteren Verlauf wollen wir nun den Quelltext hinsichtlich eines möglichen Refactorings untersuchen.</p>
</div>
<div class="section" id="aufteilen-umfangreicher-methoden">
<h3>Aufteilen umfangreicher Methoden<a class="headerlink" href="#aufteilen-umfangreicher-methoden" title="Link zu dieser Überschrift">¶</a></h3>
<p>Ausgangspunkt unserer Überlegungen ist, dass die Statement-Methode der Klasse Customer um eine html-Ausgabe erweitert werden soll. Das notwendige Verändern der Methode kann deshalb mit weiteren Optimierungen verbunden werden.</p>
</div>
<div class="section" id="methoden-herausnehmen">
<h3>Methoden herausnehmen<a class="headerlink" href="#methoden-herausnehmen" title="Link zu dieser Überschrift">¶</a></h3>
<div class="sidebar">
<p class="first sidebar-title">Regel</p>
<p class="last">Extract Method</p>
</div>
<p>Eine Reduzierung der Komplexität einer Methode besteht häufig daran, logische Teile innerhalb einer Methode zu finden, diese auszulagern und damit die Komplexität der Methode zu verringern.</p>
<div class="admonition-aufgabe admonition">
<p class="first admonition-title">Aufgabe</p>
<p class="last">Welche Teile des Statement-Methode würden sich dazu anbieten ?</p>
</div>
<a class="reference internal image-reference" href="_images/refac_extract_vorher.jpg"><img alt="_images/refac_extract_vorher.jpg" src="_images/refac_extract_vorher.jpg" style="width: 300px;" /></a>
<a class="reference internal image-reference" href="_images/refac_extract_nachher.jpg"><img alt="_images/refac_extract_nachher.jpg" src="_images/refac_extract_nachher.jpg" style="width: 300px;" /></a>
<a class="reference internal image-reference" href="_images/refac_extract_nachher_2.jpg"><img alt="_images/refac_extract_nachher_2.jpg" src="_images/refac_extract_nachher_2.jpg" style="width: 300px;" /></a>
<p>In unserem Beispiel wurde die switch-Anweisung in eine eigene Methode ausgelagert. Wenn korrekte Datentypen bei der Übergabe von Parametern definiert werden, darf diese Codeänderung anschließend keine negativen Auswirkungen auf diese Tests haben.</p>
<img alt="_images/testergebnis_refactor_1.jpg" src="_images/testergebnis_refactor_1.jpg" />
<p>Die Codemetriken für diese Methode ändern sich ebenfalls in die positive Richtung.</p>
<img alt="_images/refactor_method_1_metrics_vorher.jpg" src="_images/refactor_method_1_metrics_vorher.jpg" />
<img alt="_images/refactor_method_1_metrics_nachher.jpg" src="_images/refactor_method_1_metrics_nachher.jpg" />
</div>
<div class="section" id="umbenennen">
<h3>Umbenennen<a class="headerlink" href="#umbenennen" title="Link zu dieser Überschrift">¶</a></h3>
<div class="sidebar">
<p class="first sidebar-title">Regel</p>
<p class="last">Renaming</p>
</div>
<p>Nachdem die Tests keine Fehler liefern, kann die neue Version noch zum Umbenennen von einigen Variablen genommen werden. Moderne IDE’s unterstützen den Entwickler dabei weitgehend und verständliche Namen erhöhen die Nachvollziehbarkeit des Quellcodes.</p>
<img alt="_images/refactor_rename.jpg" src="_images/refactor_rename.jpg" />
<p>Ein Neukompilieren sowie das Ausführen der Tests bestätigt, dass es keine Fehler gegeben hat.</p>
</div>
<div class="section" id="methoden-verschieben">
<h3>Methoden verschieben<a class="headerlink" href="#methoden-verschieben" title="Link zu dieser Überschrift">¶</a></h3>
<div class="sidebar">
<p class="first sidebar-title">Regel</p>
<p class="last">Move Methods</p>
</div>
<p>Beim Betrachten der eben erstellten Methode <strong>amountFor()</strong> fällt auf, dass diese Informationen aus der <em>Rental</em>-Klasse benutzt, aber eigentlich überhaupt keine Informationen aus der <em>Customer</em>-Klasse. Es fehlt damit die Kohäsion zwischen Methode und Instanzattributen und ein entsprechendes Metrik-Tool würde hier sicherlich einen schlechten LCOM-Metrik errechnen.</p>
<p>Die Methode wäre deshalb besser in der <em>rental</em>-Klasse aufgehoben. man kopiert deshalb zunächst die Methode in die entsprechende Klasse und passt Sie anschließend wie folgt an.</p>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="kt">double</span> <span class="nf">GetCharge</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">result</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="c1">// Determine amounts for each line</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">m_Movie</span><span class="p">.</span><span class="n">PriceCode</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">case</span> <span class="n">PriceCodes</span><span class="p">.</span><span class="n">Regular</span><span class="p">:</span>
            <span class="n">result</span> <span class="p">+=</span> <span class="m">2</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">DaysRented</span> <span class="p">&gt;</span> <span class="m">2</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">result</span> <span class="p">+=</span> <span class="p">(</span><span class="n">DaysRented</span> <span class="p">-</span> <span class="m">2</span><span class="p">)</span> <span class="p">*</span> <span class="m">1.5</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="n">PriceCodes</span><span class="p">.</span><span class="n">NewRelease</span><span class="p">:</span>
            <span class="n">result</span> <span class="p">+=</span> <span class="n">DaysRented</span> <span class="p">*</span> <span class="m">3</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="n">PriceCodes</span><span class="p">.</span><span class="n">Childrens</span><span class="p">:</span>
            <span class="n">result</span> <span class="p">+=</span> <span class="m">1.5</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">DaysRented</span> <span class="p">&gt;</span> <span class="m">3</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">result</span> <span class="p">+=</span> <span class="p">(</span><span class="n">DaysRented</span> <span class="p">-</span> <span class="m">3</span><span class="p">)</span> <span class="p">*</span> <span class="m">1.5</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In der Klasse <em>Customer</em> ist der Quellcode der amountFor-Methode durch folgende Vereinfachung anzupassen.</p>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="kt">double</span> <span class="nf">amountFor</span><span class="p">(</span><span class="n">Rental</span> <span class="n">aRental</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">aRental</span><span class="p">.</span><span class="n">GetCharge</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Falls es immer noch fehlerfrei läuft, kann die amountFor-Methode vernachlässigt werden. Die Umleitung auf die Rental-Klasse kann wieder direkt in der Statement()-Methode erfolgen.</p>
<img alt="_images/refac_move_method_2.jpg" src="_images/refac_move_method_2.jpg" />
<p>Die vorhandenen UnitTests sollten noch immer funktionieren und auch die CodeMetrik sollte keine signifikanten Änderungen erfahren haben.</p>
<img alt="_images/refac_move_method_metrics.jpg" src="_images/refac_move_method_metrics.jpg" />
<p>Das abschließende Klassendiagramm hat sich vom Ausgangspunkt wie folgt geändert.</p>
<img alt="_images/prgramm_startingpoint.jpg" src="_images/prgramm_startingpoint.jpg" />
<img alt="_images/kd_refac_methods.jpg" src="_images/kd_refac_methods.jpg" />
<p><strong>UnitTests</strong></p>
<p>Durch die neue öffentliche Methode in <strong>Rental</strong> müssten für getcharge() neue UnitTests geschrieben werden. Sie können diese unter UnitTest3.cs in ihr Projekt integrieren.</p>
</div>
<div class="section" id="eliminiere-temp-variablen">
<h3>Eliminiere Temp-Variablen<a class="headerlink" href="#eliminiere-temp-variablen" title="Link zu dieser Überschrift">¶</a></h3>
<div class="sidebar">
<p class="first sidebar-title">Regel</p>
<p class="last">Replace Temp with Query</p>
</div>
<p>Temporäre Variablen sind ein weiteres Indiz für Optimierungen. Sie überleben häufig im Produktivcode und nach einiger Zeit ist man sich deren Notwendigkeit unsicher.</p>
<p>In unserem beispiel kann die Deklaration und Benutzung von thisAmount in der while-Schleife durch each.getCharge() ersetzt werden.</p>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="p">(</span> <span class="n">rentals</span><span class="p">.</span><span class="n">MoveNext</span><span class="p">()</span> <span class="p">)</span>
<span class="p">{</span>

        <span class="n">Rental</span> <span class="n">each</span> <span class="p">=</span> <span class="p">(</span><span class="n">Rental</span><span class="p">)</span><span class="n">rentals</span><span class="p">.</span><span class="n">Current</span><span class="p">;</span>

        <span class="c1">// Determine amounts for each line</span>
                                        <span class="c1">// Add frequent renter points</span>
        <span class="n">frequentRenterPoints</span><span class="p">++;</span>

        <span class="c1">// Add bonus for a two-day new-release rental</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">each</span><span class="p">.</span><span class="n">Movie</span><span class="p">.</span><span class="n">PriceCode</span> <span class="p">==</span> <span class="n">PriceCodes</span><span class="p">.</span><span class="n">NewRelease</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="p">(</span><span class="n">each</span><span class="p">.</span><span class="n">DaysRented</span> <span class="p">&gt;</span> <span class="m">1</span><span class="p">))</span>
        <span class="p">{</span>
                <span class="n">frequentRenterPoints</span> <span class="p">++;</span>
        <span class="p">}</span>

        <span class="c1">// Show figures for this rental</span>
        <span class="n">result</span> <span class="p">+=</span> <span class="s">&quot;\t&quot;</span> <span class="p">+</span> <span class="n">each</span><span class="p">.</span><span class="n">Movie</span><span class="p">.</span><span class="n">Title</span> <span class="p">+</span> <span class="s">&quot;\t&quot;</span> <span class="p">+</span> <span class="n">each</span><span class="p">.</span><span class="n">GetCharge</span><span class="p">().</span><span class="n">ToString</span><span class="p">()</span> <span class="p">+</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
        <span class="n">totalAmount</span> <span class="p">+=</span> <span class="n">each</span><span class="p">.</span><span class="n">GetCharge</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Die Optimierung hinsichtlich der Lesbarkeit wird in diesem Beispiel natürlich durch eine doppelte Berechnung hinterfragbar. Dieser Nachteil wäre aber durch eine Änderung in der Klasse Rental ausgleichbar. Darauf wird später noch eingegangen</p>
</div>
<div class="section" id="auslagern-von-methoden">
<h3>Auslagern von Methoden<a class="headerlink" href="#auslagern-von-methoden" title="Link zu dieser Überschrift">¶</a></h3>
<div class="sidebar">
<p class="first sidebar-title">Regel</p>
<p class="last">Move Methods</p>
</div>
<p>Auch die Rabattpunkte sind ein Kandidat für das Auslagern in eine andere Methode.</p>
<img alt="_images/refac_frequent_renter.jpg" src="_images/refac_frequent_renter.jpg" />
<p>Bei der Implementierung der Methode ist zu beachten, dass die <em>frequentrenterPoints</em>-Variable evtl. zweimal erhöht wird. Dies ist in der Methode entsprechend zu implementieren.</p>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Customer</span>
<span class="p">{</span>
<span class="c1">//....</span>

   <span class="k">while</span> <span class="p">(</span> <span class="n">rentals</span><span class="p">.</span><span class="n">MoveNext</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
   <span class="n">Rental</span> <span class="n">each</span> <span class="p">=</span> <span class="p">(</span><span class="n">Rental</span><span class="p">)</span><span class="n">rentals</span><span class="p">.</span><span class="n">Current</span><span class="p">;</span>

   <span class="n">frequentRenterPoints</span> <span class="p">+=</span> <span class="n">each</span><span class="p">.</span><span class="n">GetFrequentRenterPoints</span><span class="p">();</span>

   <span class="c1">// Show figures for this rental</span>


<span class="k">class</span> <span class="nc">Rental</span>
<span class="p">{</span>

<span class="p">....</span>

 <span class="k">public</span> <span class="kt">int</span> <span class="nf">GetFrequentRenterPoints</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Movie</span><span class="p">.</span><span class="n">PriceCode</span> <span class="p">==</span> <span class="n">PriceCodes</span><span class="p">.</span><span class="n">NewRelease</span> <span class="p">&amp;&amp;</span> <span class="n">DaysRented</span> <span class="p">&gt;</span> <span class="m">1</span><span class="p">)</span>
                <span class="k">return</span> <span class="m">2</span><span class="p">;</span>
        <span class="k">else</span>
                <span class="k">return</span> <span class="m">1</span><span class="p">;</span>
 <span class="p">}</span>
</pre></div>
</div>
<p>Weitere Tests sichern die Funktionalität der ausgelagerten Methode.</p>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="na">[Test]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">TestNewPublicMethod_RentalGetFrequentRenterPointsNewReleasePrice</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Rental</span> <span class="n">_RentalSuperman1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Rental</span><span class="p">(</span><span class="k">new</span> <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;Superman&quot;</span><span class="p">,</span> <span class="n">PriceCodes</span><span class="p">.</span><span class="n">NewRelease</span><span class="p">),</span><span class="m">1</span><span class="p">);</span>
  <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">_RentalSuperman1</span><span class="p">.</span><span class="n">GetFrequentRenterPoints</span><span class="p">());</span>

  <span class="n">Rental</span> <span class="n">_RentalSuperman3</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Rental</span><span class="p">(</span><span class="k">new</span> <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;Superman&quot;</span><span class="p">,</span> <span class="n">PriceCodes</span><span class="p">.</span><span class="n">NewRelease</span><span class="p">),</span><span class="m">3</span><span class="p">);</span>
  <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="n">_RentalSuperman3</span><span class="p">.</span><span class="n">GetFrequentRenterPoints</span><span class="p">());</span>
<span class="p">}</span>

<span class="na">[Test]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">TestNewPublicMethod_RentalGetFrequentRenterPointsChildrensPrice</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Rental</span> <span class="n">_RentalSuperman1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Rental</span><span class="p">(</span><span class="k">new</span> <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;Superman&quot;</span><span class="p">,</span> <span class="n">PriceCodes</span><span class="p">.</span><span class="n">Childrens</span><span class="p">),</span><span class="m">1</span><span class="p">);</span>
  <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">_RentalSuperman1</span><span class="p">.</span><span class="n">GetFrequentRenterPoints</span><span class="p">());</span>

  <span class="n">Rental</span> <span class="n">_RentalSuperman3</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Rental</span><span class="p">(</span><span class="k">new</span> <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;Superman&quot;</span><span class="p">,</span> <span class="n">PriceCodes</span><span class="p">.</span><span class="n">Childrens</span><span class="p">),</span><span class="m">3</span><span class="p">);</span>
  <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">_RentalSuperman3</span><span class="p">.</span><span class="n">GetFrequentRenterPoints</span><span class="p">());</span>
<span class="p">}</span>

<span class="na">[Test]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">TestNewPublicMethod_RentalGetFrequentRenterPointsRegularPrice</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Rental</span> <span class="n">_RentalSuperman1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Rental</span><span class="p">(</span><span class="k">new</span> <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;Superman&quot;</span><span class="p">,</span> <span class="n">PriceCodes</span><span class="p">.</span><span class="n">Regular</span><span class="p">),</span><span class="m">1</span><span class="p">);</span>
  <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">_RentalSuperman1</span><span class="p">.</span><span class="n">GetFrequentRenterPoints</span><span class="p">());</span>

  <span class="n">Rental</span> <span class="n">_RentalSuperman3</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Rental</span><span class="p">(</span><span class="k">new</span> <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;Superman&quot;</span><span class="p">,</span> <span class="n">PriceCodes</span><span class="p">.</span><span class="n">Regular</span><span class="p">),</span><span class="m">3</span><span class="p">);</span>
  <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">_RentalSuperman3</span><span class="p">.</span><span class="n">GetFrequentRenterPoints</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Das Klassendiagramm ändert sich entsprechend.</p>
<img alt="_images/kd_refac_renterpoints.jpg" src="_images/kd_refac_renterpoints.jpg" />
<p>Die Metriken für das Projekt haben anschließend folgende Werte:</p>
<img alt="_images/metrik_nach_frequentrentner.jpg" src="_images/metrik_nach_frequentrentner.jpg" />
</div>
<div class="section" id="code-verbesserungen">
<h3>Code-Verbesserungen<a class="headerlink" href="#code-verbesserungen" title="Link zu dieser Überschrift">¶</a></h3>
<p>Innerhalb der Statement-Methode kann eine weitere Verbesserung dadurch erreich werden, dass man die Java-Like „enumerator - while“-Schleife durch ein foreach-Konstrukt ersetzt.</p>
<img alt="_images/enumerator_foreach.jpg" src="_images/enumerator_foreach.jpg" />
<img alt="_images/enumerator_foreach_2.jpg" src="_images/enumerator_foreach_2.jpg" />
<p>Die Statement()-Methode sieht nun wie folgt aus:</p>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="kt">string</span> <span class="nf">Statement</span><span class="p">()</span>
<span class="p">{</span>
        <span class="kt">double</span> <span class="n">totalAmount</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">frequentRenterPoints</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>

        <span class="kt">string</span> <span class="n">result</span> <span class="p">=</span> <span class="s">&quot;Rental record for &quot;</span> <span class="p">+</span> <span class="n">m_Name</span> <span class="p">+</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
        <span class="k">foreach</span> <span class="p">(</span> <span class="n">Rental</span> <span class="n">each</span> <span class="k">in</span> <span class="n">m_Rentals</span> <span class="p">)</span>
        <span class="p">{</span>

                <span class="c1">// Determine amounts for each line</span>
                <span class="c1">// Add frequent renter points</span>
                <span class="n">frequentRenterPoints</span> <span class="p">+=</span> <span class="n">each</span><span class="p">.</span><span class="n">GetFrequentRenterPoints</span><span class="p">();</span>

                <span class="c1">// Show figures for this rental</span>
                <span class="n">result</span> <span class="p">+=</span> <span class="s">&quot;\t&quot;</span> <span class="p">+</span> <span class="n">each</span><span class="p">.</span><span class="n">Movie</span><span class="p">.</span><span class="n">Title</span> <span class="p">+</span> <span class="s">&quot;\t&quot;</span> <span class="p">+</span> <span class="n">each</span><span class="p">.</span><span class="n">GetCharge</span><span class="p">().</span><span class="n">ToString</span><span class="p">()</span> <span class="p">+</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
                <span class="n">totalAmount</span> <span class="p">+=</span> <span class="n">each</span><span class="p">.</span><span class="n">GetCharge</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// Add footer lines</span>
        <span class="n">result</span> <span class="p">+=</span> <span class="s">&quot;Amount owed is &quot;</span> <span class="p">+</span> <span class="n">totalAmount</span><span class="p">.</span><span class="n">ToString</span><span class="p">()</span> <span class="p">+</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
        <span class="n">result</span> <span class="p">+=</span> <span class="s">&quot;You earned &quot;</span> <span class="p">+</span> <span class="n">frequentRenterPoints</span><span class="p">.</span><span class="n">ToString</span><span class="p">()</span> <span class="p">+</span> <span class="s">&quot; frequent renter points.&quot;</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="temporare-variablen-ersetzen">
<h3>Temporäre Variablen ersetzen<a class="headerlink" href="#temporare-variablen-ersetzen" title="Link zu dieser Überschrift">¶</a></h3>
<div class="sidebar">
<p class="first sidebar-title">Regel</p>
<p class="last">Replace temp with Query</p>
</div>
<p>Wie schon weiter oben erwähnt, können temporäre Variablen ein Problem darstellen.</p>
<ul class="simple">
<li>Sie sind nur nutzbar in der der eigenen Methode</li>
<li>Keine Wiederverwendbarkeit</li>
</ul>
<p>In unserem Beispiel bieten sich die Variablen <strong>totalAmount</strong> sowie <strong>frequentRentalPoints</strong> zum Refaktorisieren an.</p>
<img alt="_images/get_totalcharge.jpg" src="_images/get_totalcharge.jpg" />
<p>Da <em>totalAmount</em> innerhalb einer Schleife errechnet wurde, muss diese Schleifenstruktur innerhalb der Methode getTotalCharge() nachgebildet werden.</p>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="kt">double</span> <span class="nf">GetTotalCharge</span><span class="p">()</span> <span class="p">{</span>
   <span class="kt">double</span> <span class="n">result</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
   <span class="k">foreach</span> <span class="p">(</span> <span class="n">Rental</span> <span class="n">each</span> <span class="k">in</span> <span class="n">m_Rentals</span> <span class="p">)</span> <span class="p">{</span>
     <span class="n">result</span> <span class="p">+=</span> <span class="n">each</span><span class="p">.</span><span class="n">GetCharge</span><span class="p">();</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Die gleiche Vorgehensweise ist für frequentrenterPoints nachzuholen.</p>
<div class="admonition-aufgabe admonition">
<p class="first admonition-title">Aufgabe</p>
<p>Erstellen Sie eine Methode <em>GetTotalFrequentRenterPoints</em> und führen Sie die Refaktorisierung durch.</p>
<img alt="_images/frequent_renter_points_1.jpg" class="last" src="_images/frequent_renter_points_1.jpg" />
</div>
<div class="admonition-losung admonition">
<p class="first admonition-title">Lösung</p>
<div class="last highlight-csharp"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="kt">string</span> <span class="nf">Statement</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="n">result</span> <span class="p">=</span> <span class="s">&quot;Rental record for &quot;</span> <span class="p">+</span> <span class="n">m_Name</span> <span class="p">+</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
  <span class="k">foreach</span> <span class="p">(</span> <span class="n">Rental</span> <span class="n">each</span> <span class="k">in</span> <span class="n">m_Rentals</span> <span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Show figures for this rental</span>
    <span class="n">result</span> <span class="p">+=</span> <span class="s">&quot;\t&quot;</span> <span class="p">+</span> <span class="n">each</span><span class="p">.</span><span class="n">Movie</span><span class="p">.</span><span class="n">title</span> <span class="p">+</span> <span class="s">&quot;\t&quot;</span> <span class="p">+</span> <span class="n">each</span><span class="p">.</span><span class="n">GetCharge</span><span class="p">().</span><span class="n">ToString</span><span class="p">()</span> <span class="p">+</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Add footer lines</span>
  <span class="n">result</span> <span class="p">+=</span> <span class="s">&quot;Amount owed is &quot;</span> <span class="p">+</span> <span class="n">GetTotalCharge</span><span class="p">().</span><span class="n">ToString</span><span class="p">()</span> <span class="p">+</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
  <span class="n">result</span> <span class="p">+=</span> <span class="s">&quot;You earned &quot;</span> <span class="p">+</span> <span class="n">GetTotalFrequentRenterPoints</span><span class="p">().</span><span class="n">ToString</span><span class="p">()</span>
    <span class="p">+</span> <span class="s">&quot; frequent renter points.&quot;</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">private</span> <span class="kt">int</span> <span class="nf">GetTotalFrequentRenterPoints</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">result</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
  <span class="k">foreach</span> <span class="p">(</span> <span class="n">Rental</span> <span class="n">each</span> <span class="k">in</span> <span class="n">m_Rentals</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">result</span> <span class="p">+=</span> <span class="n">each</span><span class="p">.</span><span class="n">GetFrequentRenterPoints</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="admonition-ubersetzen-sie-die-folgenden-aussagen-sinngemasz admonition">
<p class="first admonition-title">Übersetzen Sie die folgenden Aussagen sinngemäß</p>
<p>It is worth stopping to think a bit about the last refactoring. Most refactorings reduce the amount of code, but this one  increases it. That’s because Java 1.1 requires a lot of statements to set up a summing loop. Even a simple summing loop with one line of code per element needs six lines of support around it. It’s an idiom that is obvious to any programmer but is a lot of lines all the same.</p>
<p>The other concern with this refactoring lies in performance. The old code executed the „while“ loop once, the new code executes it three times. A while loop that takes a long time might impair performance. Many programmers would not do this refactoring simply for this reason. But note the words if and might. Until I profile I cannot tell how much time is needed for the loop to calculate or whether the loop is called often enough for it to affect the overall performance of the system.</p>
<p>Don’t worry about this while refactoring. When you optimize you will have to worry about it, but you will then be in a much better position to do something about it, and you will have more options to optimize effectively.</p>
<p class="last">These queries are now available for any code written in the customer class. They can easily be added to the interface of the class should other parts of the system need this information. Without queries like these, other methods have to deal with knowing about the rentals and building the loops. In a complex system, that will lead to much more code to write and maintain.</p>
</div>
</div>
<div class="section" id="html-statement">
<h3>HTML-Statement<a class="headerlink" href="#html-statement" title="Link zu dieser Überschrift">¶</a></h3>
<p>Nach all den Refaktoriesierungen ist es nun einfach, eine HTML-Statement-Methode zu schreiben, da Sie viele interne Implementierungen wiederverwenden kann.</p>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="kt">string</span> <span class="nf">HTMLStatement</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">string</span> <span class="n">result</span> <span class="p">=</span> <span class="s">&quot;&lt;H1&gt;Rental record for &lt;EM&gt;&quot;</span> <span class="p">+</span> <span class="n">m_Name</span> <span class="p">+</span> <span class="s">&quot;&lt;/EM&gt;&lt;/H1&gt;&lt;P&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="n">Rental</span> <span class="n">each</span> <span class="k">in</span> <span class="n">m_Rentals</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="p">+=</span> <span class="n">each</span><span class="p">.</span><span class="n">Movie</span><span class="p">.</span><span class="n">title</span> <span class="p">+</span> <span class="s">&quot;: &quot;</span> <span class="p">+</span> <span class="n">each</span><span class="p">.</span><span class="n">GetCharge</span><span class="p">().</span><span class="n">ToString</span><span class="p">()</span> <span class="p">+</span> <span class="s">&quot;&lt;BR&gt;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Add footer lines</span>
    <span class="n">result</span> <span class="p">+=</span> <span class="s">&quot;&lt;P&gt;Amount owed is &lt;EM&gt;&quot;</span> <span class="p">+</span> <span class="n">GetTotalCharge</span><span class="p">().</span><span class="n">ToString</span><span class="p">()</span> <span class="p">+</span> <span class="s">&quot;&lt;/EM&gt;&lt;P&gt;\n&quot;</span><span class="p">;</span>
    <span class="n">result</span> <span class="p">+=</span> <span class="s">&quot;You earned &lt;EM&gt;&quot;</span> <span class="p">+</span> <span class="n">GetTotalFrequentRenterPoints</span><span class="p">().</span><span class="n">ToString</span><span class="p">()</span>
      <span class="p">+</span> <span class="s">&quot;&lt;/EM&gt; frequent renter points.&lt;P&gt;&quot;</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="neue-unit-tests">
<h3>Neue Unit-Tests<a class="headerlink" href="#neue-unit-tests" title="Link zu dieser Überschrift">¶</a></h3>
<p>Die HTML-Statement-Methode maht natürlich auch neue Unit-Tests notwendig.</p>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="na">[Test]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">TestHTMLstatement</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Customer</span> <span class="n">_LiverLips</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Customer</span><span class="p">(</span><span class="s">&quot;Liver Lips&quot;</span><span class="p">);</span>
    <span class="n">_LiverLips</span><span class="p">.</span><span class="n">AddRental</span><span class="p">(</span><span class="k">new</span> <span class="n">Rental</span><span class="p">(</span><span class="k">new</span> <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;Enforcer&quot;</span><span class="p">,</span> <span class="n">PriceCodes</span><span class="p">.</span><span class="n">Childrens</span><span class="p">),</span> <span class="m">10</span><span class="p">));</span>
    <span class="n">_LiverLips</span><span class="p">.</span><span class="n">AddRental</span><span class="p">(</span><span class="k">new</span> <span class="n">Rental</span><span class="p">(</span><span class="k">new</span> <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;Apollo 13&quot;</span><span class="p">,</span> <span class="n">PriceCodes</span><span class="p">.</span><span class="n">NewRelease</span><span class="p">),</span> <span class="m">3</span><span class="p">));</span>
    <span class="n">_LiverLips</span><span class="p">.</span><span class="n">AddRental</span><span class="p">(</span><span class="k">new</span> <span class="n">Rental</span><span class="p">(</span><span class="k">new</span> <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;Pulp Fiction&quot;</span><span class="p">,</span> <span class="n">PriceCodes</span><span class="p">.</span><span class="n">Regular</span><span class="p">),</span> <span class="m">4</span><span class="p">));</span>

    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="s">&quot;Liver Lips&quot;</span><span class="p">,</span> <span class="n">_LiverLips</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span>
      <span class="p">(</span><span class="s">&quot;&lt;H1&gt;Rental record for &lt;EM&gt;Liver Lips&lt;/EM&gt;&lt;/H1&gt;&lt;P&gt;\nEnforcer: 12&lt;BR&gt;\nApollo 13: &quot;</span>
      <span class="p">+</span> <span class="s">&quot;9&lt;BR&gt;\nPulp Fiction: 5&lt;BR&gt;\n&lt;P&gt;Amount owed is &lt;EM&gt;26&lt;/EM&gt;&lt;P&gt;\n&quot;</span>
      <span class="p">+</span> <span class="s">&quot;You earned &lt;EM&gt;4&lt;/EM&gt; frequent renter points.&lt;P&gt;&quot;</span>
      <span class="p">,</span> <span class="n">_LiverLips</span><span class="p">.</span><span class="n">HTMLStatement</span><span class="p">());</span>
    <span class="n">_LiverLips</span><span class="p">.</span><span class="n">AddRental</span><span class="p">(</span><span class="k">new</span> <span class="n">Rental</span><span class="p">(</span><span class="k">new</span> <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;The Good, The Bad, And The Ugly&quot;</span>
      <span class="p">,</span> <span class="n">PriceCodes</span><span class="p">.</span><span class="n">Childrens</span><span class="p">),</span> <span class="m">10</span><span class="p">));</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span>
      <span class="p">(</span><span class="s">&quot;&lt;H1&gt;Rental record for &lt;EM&gt;Liver Lips&lt;/EM&gt;&lt;/H1&gt;&lt;P&gt;\nEnforcer: 12&lt;BR&gt;\nApollo 13: &quot;</span>
      <span class="p">+</span> <span class="s">&quot;9&lt;BR&gt;\nPulp Fiction: 5&lt;BR&gt;\nThe Good, The Bad, And The Ugly: 12&lt;BR&gt;\n&lt;P&gt;&quot;</span>
      <span class="p">+</span> <span class="s">&quot;Amount owed is &lt;EM&gt;38&lt;/EM&gt;&lt;P&gt;\nYou earned &lt;EM&gt;5&lt;/EM&gt; frequent renter points.&lt;P&gt;&quot;</span>
      <span class="p">,</span> <span class="n">_LiverLips</span><span class="p">.</span><span class="n">HTMLStatement</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="vergleich-vorher-nachher">
<h3>Vergleich vorher/nachher<a class="headerlink" href="#vergleich-vorher-nachher" title="Link zu dieser Überschrift">¶</a></h3>
<p>Obwohl natürlich auch in anderen Klassen Veränderungen vorgenommen wurden, ist ein Vergleich der Statement()-Methode zu Beginn und zum jetzigen Zeitpunkt interessant.</p>
<p>Man kann in der Versionsverwaltung durch ein Compare von Head und Revision 1 erreichen.</p>
<img alt="_images/vorher_nachher_1.jpg" src="_images/vorher_nachher_1.jpg" />
<img alt="_images/vorher_nachher_2.jpg" src="_images/vorher_nachher_2.jpg" />
<img alt="_images/vorher_nachher_3.jpg" src="_images/vorher_nachher_3.jpg" />
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Inhalt</a></h3>
  <ul>
<li><a class="reference internal" href="#">Continuous Integration</a><ul>
<li><a class="reference internal" href="#einleitung">Einleitung</a></li>
<li><a class="reference internal" href="#runde-1">Runde 1</a><ul>
<li><a class="reference internal" href="#infrastruktur">Infrastruktur</a></li>
<li><a class="reference internal" href="#das-programm">Das Programm</a></li>
<li><a class="reference internal" href="#entwickeln-unter-einer-versionsverwaltung">Entwickeln unter einer Versionsverwaltung</a></li>
<li><a class="reference internal" href="#erstellen-von-unit-tests">Erstellen von Unit-Tests</a></li>
<li><a class="reference internal" href="#ausfuhren-der-tests">Ausführen der Tests</a></li>
<li><a class="reference internal" href="#commit-der-anderungen">Commit der Änderungen</a></li>
</ul>
</li>
<li><a class="reference internal" href="#runde-2">Runde 2</a><ul>
<li><a class="reference internal" href="#automatische-builds">Automatische Builds</a></li>
<li><a class="reference internal" href="#nant">NANT</a></li>
<li><a class="reference internal" href="#msbuild">MSBUILD</a></li>
<li><a class="reference internal" href="#nunit-integration">NUnit-Integration</a></li>
<li><a class="reference internal" href="#metrics-integration">Metrics-Integration</a></li>
<li><a class="reference internal" href="#was-soll-das">Was soll das ?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#runde-3">Runde 3</a><ul>
<li><a class="reference internal" href="#ci-server-jenkins">CI Server Jenkins</a></li>
<li><a class="reference internal" href="#jobs-anlegen">Jobs anlegen</a></li>
<li><a class="reference internal" href="#jobs-konfigurieren">Jobs Konfigurieren</a></li>
<li><a class="reference internal" href="#aufgaben">Aufgaben:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#runde-4">Runde 4</a><ul>
<li><a class="reference internal" href="#refactoring">Refactoring</a></li>
<li><a class="reference internal" href="#aufteilen-umfangreicher-methoden">Aufteilen umfangreicher Methoden</a></li>
<li><a class="reference internal" href="#methoden-herausnehmen">Methoden herausnehmen</a></li>
<li><a class="reference internal" href="#umbenennen">Umbenennen</a></li>
<li><a class="reference internal" href="#methoden-verschieben">Methoden verschieben</a></li>
<li><a class="reference internal" href="#eliminiere-temp-variablen">Eliminiere Temp-Variablen</a></li>
<li><a class="reference internal" href="#auslagern-von-methoden">Auslagern von Methoden</a></li>
<li><a class="reference internal" href="#code-verbesserungen">Code-Verbesserungen</a></li>
<li><a class="reference internal" href="#temporare-variablen-ersetzen">Temporäre Variablen ersetzen</a></li>
<li><a class="reference internal" href="#html-statement">HTML-Statement</a></li>
<li><a class="reference internal" href="#neue-unit-tests">Neue Unit-Tests</a></li>
<li><a class="reference internal" href="#vergleich-vorher-nachher">Vergleich vorher/nachher</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>Diese Seite</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/ci.rst.txt"
            rel="nofollow">Quellcode anzeigen</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Schnellsuche</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Los" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Stichwortverzeichnis"
             >Index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">SWE</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, STE.
      Zuletzt aktualisiert am 19. Sep. 2017.
      Mit <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3 erstellt.
    </div>
  </body>
</html>